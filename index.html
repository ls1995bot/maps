<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡πÅ‡∏´‡∏•‡∏°‡∏â‡∏ö‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (1995)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
        body { margin: 0; padding: 0; font-family: 'Sarabun', sans-serif; background: #f4f4f4; overflow: hidden; }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
        #search-container {
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 500px; z-index: 1000; display: flex; gap: 8px;
        }
        
        input { 
            flex: 1; padding: 14px 22px; border-radius: 30px; border: none; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.25); font-size: 16px; outline: none; 
        }
        
        button#clear-btn { 
            padding: 0 16px; border-radius: 50%; border: none; 
            background: #ff4757; color: white; font-weight: bold; cursor: pointer; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.15); display: none;
        }

        #map { width: 100vw; height: 100vh; background: #e0e0e0; }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Pop-up) ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 0; overflow: hidden; }
        .leaflet-popup-content { margin: 0; width: 280px !important; max-height: 500px; overflow-y: auto; }
        
        .popup-header { 
            background: #007bff; color: white; padding: 12px; 
            text-align: center; font-weight: bold; font-size: 16px;
            position: sticky; top: 0; z-index: 10; 
        }
        
        .popup-img-box { 
            width: 100%; height: 180px; background: #eee; 
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .popup-img { width: 100%; height: 100%; object-fit: cover; }
        
        .product-list-info { padding: 10px; background: #f9f9f9; font-size: 12px; color: #666; border-bottom: 1px solid #eee; }
        
        .product-list { list-style: none; padding: 0; margin: 0; }
        .product-item { 
            padding: 12px 15px; border-bottom: 1px solid #eee; 
            font-size: 14px; color: #333; display: flex; align-items: center; gap: 10px; 
        }
        .product-item:last-child { border-bottom: none; }
        .product-item .icon { font-size: 16px; opacity: 0.6; }

        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏π‡πâ */
        .flashing-rect path {
            fill: #ff0000; fill-opacity: 0.2;
            stroke: #ff0000; stroke-width: 4;
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { stroke-width: 2; fill-opacity: 0.1; }
            to { stroke-width: 8; fill-opacity: 0.5; }
        }
    </style>
</head>
<body>

    <div id="search-container">
        <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Å‡∏≤‡∏ß, ‡πÅ‡∏ü‡πâ‡∏°, A4)..." onkeyup="handleSearch()">
        <button id="clear-btn" onclick="resetMap()">‚úï</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="zones.js"></script>
    <script src="products.js"></script>

    <script>
        // --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ maps.png) ---
        const MAP_W = 8127; 
        const MAP_H = 9127; 
        const IMAGE_URL = 'maps.png'; 

        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -3,
            maxZoom: 1,
            zoomControl: false
        });
        
        const bounds = [[0, 0], [MAP_H, MAP_W]];
        L.imageOverlay(IMAGE_URL, bounds).addTo(map);
        map.fitBounds(bounds);
        
        // ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡∏π‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        let activeLayer = L.layerGroup().addTo(map);

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á) ---
        function handleSearch() {
            const keyword = document.getElementById('search-input').value.toLowerCase().trim();
            const clearBtn = document.getElementById('clear-btn');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            activeLayer.clearLayers();
            
            if (keyword.length < 2) {
                clearBtn.style.display = 'none';
                return;
            }
            clearBtn.style.display = 'block';

            // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô "‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ ‡∏°‡πâ‡∏≤"
            const searchTerms = keyword.split(' ').filter(t => t.length > 0);

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            const foundProducts = products.filter(p => {
                const zonesText = (p.zone || "") + " " + (p.zone2 || "") + " " + (p.zone3 || "");
                const productData = (p.name + " " + (p.keywords || "") + " " + p.id + " " + zonesText).toLowerCase();
                return searchTerms.every(term => productData.includes(term));
            });

            if (foundProducts.length === 0) return;

            // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡∏π‡πâ (‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å zoneConfig ‡πÉ‡∏ô zones.js)
            const groups = {};
            foundProducts.forEach(p => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á 3 ‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ
                const targetZones = [p.zone, p.zone2, p.zone3].filter(z => z);

                targetZones.forEach(zoneName => {
                    const config = zoneConfig[zoneName];
                    if (config) {
                        if (!groups[zoneName]) {
                            groups[zoneName] = { 
                                bounds: config.bounds, 
                                zoneName: zoneName, 
                                items: [], 
                                shelfImage: config.image 
                            };
                        }
                        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥
                        if (!groups[zoneName].items.includes(p.name)) {
                            groups[zoneName].items.push(p.name);
                        }
                    }
                });
            });

            const boundsList = [];
            Object.values(groups).forEach(g => {
                // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
                const rect = L.rectangle(g.bounds, { 
                    className: 'flashing-rect', 
                    color: 'red', 
                    weight: 1 
                }).addTo(activeLayer);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Pop-up
                let popupHtml = `<div class="popup-header">${g.zoneName}</div>`;
                
                if (g.shelfImage) {
                    popupHtml += `<div class="popup-img-box"><img src="${g.shelfImage}" class="popup-img"></div>`;
                }

                popupHtml += `<div class="product-list-info">‡∏û‡∏ö ${g.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</div>`;
                popupHtml += `<ul class="product-list">`;
                g.items.forEach(name => {
                    popupHtml += `<li class="product-item"><span class="icon">üì¶</span> <span>${name}</span></li>`;
                });
                popupHtml += `</ul>`;

                rect.bindPopup(popupHtml);
                boundsList.push(g.bounds);
            });

            // ‡∏ã‡∏π‡∏°‡πÑ‡∏õ‡∏´‡∏≤‡∏ï‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠
            if (boundsList.length > 0) {
                const groupBounds = L.latLngBounds(boundsList);
                map.fitBounds(groupBounds.pad(0.4));
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                activeLayer.eachLayer(layer => {
                    if (layer instanceof L.Rectangle && Object.keys(groups).length === 1) {
                        layer.openPopup();
                    }
                });
            }
        }

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤ ---
        function resetMap() {
            document.getElementById('search-input').value = '';
            activeLayer.clearLayers();
            map.fitBounds(bounds);
            document.getElementById('clear-btn').style.display = 'none';
        }
    </script>
</body>
</html>